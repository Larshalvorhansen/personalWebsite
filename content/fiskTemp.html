<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Contribution Graph</title>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="flex flex-col items-center">
        <h1 class="text-xl font-bold mb-4">2017 Contributions</h1>

        <!-- CSV File Input -->
        <input type="file" id="csvFileInput" class="mb-4 p-2 border border-gray-300 rounded" accept=".csv">

        <!-- Month Labels -->
        <div class="grid grid-cols-12 gap-1 mb-2 text-xs text-gray-500 w-full">
            <span class="text-center">Jan</span>
            <span class="text-center">Feb</span>
            <span class="text-center">Mar</span>
            <span class="text-center">Apr</span>
            <span class="text-center">May</span>
            <span class="text-center">Jun</span>
            <span class="text-center">Jul</span>
            <span class="text-center">Aug</span>
            <span class="text-center">Sep</span>
            <span class="text-center">Oct</span>
            <span class="text-center">Nov</span>
            <span class="text-center">Dec</span>
        </div>

        <!-- Contribution Grid -->
        <div class="flex">
            <!-- Day Labels -->
            <div class="flex flex-col space-y-1 mr-2 text-xs text-gray-500">
                <span>Sun</span>
                <span>Mon</span>
                <span>Tue</span>
                <span>Wed</span>
                <span>Thu</span>
                <span>Fri</span>
                <span>Sat</span>
            </div>

            <!-- Contribution Squares -->
            <div class="grid grid-rows-7 grid-flow-col gap-1"></div>
        </div>
    </div>

    <script>
        const container = document.querySelector('.grid-rows-7');

        // Helper function to get the date for a given day number
        function getDateFromDay(dayNumber) {
            const date = new Date(2017, 0); // Start at January 1, 2017
            date.setDate(dayNumber); // Add the day number
            return date.toDateString(); // Return formatted date string
        }

        // Function to generate the contribution grid
        function generateGrid(csvData) {
            container.innerHTML = ''; // Clear the container first

            for (let i = 1; i <= 365; i++) {
                const dayBox = document.createElement('div');
                dayBox.classList.add('w-4', 'h-4', 'rounded-sm', 'transition-colors', 'duration-200');

                // Apply green color if the day is in the CSV data, otherwise gray
                if (csvData.includes(i)) {
                    dayBox.classList.add('bg-green-500');
                } else {
                    dayBox.classList.add('bg-gray-300');
                }

                // Add hover effect
                dayBox.addEventListener('mouseenter', () => {
                    dayBox.classList.add('ring', 'ring-offset-1', 'ring-green-700');
                });
                dayBox.addEventListener('mouseleave', () => {
                    dayBox.classList.remove('ring', 'ring-offset-1', 'ring-green-700');
                });

                // Add a tooltip with the date
                dayBox.setAttribute('title', getDateFromDay(i));

                // Append day box to the container
                container.appendChild(dayBox);
            }
        }

        // Event listener for file input
        document.getElementById('csvFileInput').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const text = e.target.result;
                    const lines = text.split('\n');
                    if (lines.length > 0) {
                        const firstLine = lines[0].trim();
                        const csvData = firstLine.split(',').map(Number); // Parse the first line into numbers
                        generateGrid(csvData); // Generate the grid using parsed data
                    }
                };
                reader.readAsText(file);
            }
        });
    </script>
</body>

</html>